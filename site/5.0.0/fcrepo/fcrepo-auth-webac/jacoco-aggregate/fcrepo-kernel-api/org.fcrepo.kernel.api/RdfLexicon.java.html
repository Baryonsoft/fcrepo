<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>RdfLexicon.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Fedora Repository WebAC Authorization Module</a> &gt; <a href="../index.html" class="el_bundle">fcrepo-kernel-api</a> &gt; <a href="index.source.html" class="el_package">org.fcrepo.kernel.api</a> &gt; <span class="el_source">RdfLexicon.java</span></div><h1>RdfLexicon.java</h1><pre class="source lang-java linenums">/*
 * Licensed to DuraSpace under one or more contributor license agreements.
 * See the NOTICE file distributed with this work for additional information
 * regarding copyright ownership.
 *
 * DuraSpace licenses this file to you under the Apache License,
 * Version 2.0 (the &quot;License&quot;); you may not use this file except in
 * compliance with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.fcrepo.kernel.api;

import static com.google.common.collect.ImmutableSet.of;
import static org.apache.jena.rdf.model.ResourceFactory.createProperty;
import static org.apache.jena.rdf.model.ResourceFactory.createResource;

import java.util.Set;
import java.util.function.Predicate;
import java.util.stream.Collectors;

import org.apache.jena.rdf.model.Property;
import org.apache.jena.rdf.model.Resource;

import com.google.common.collect.ImmutableSet;

/**
 * A lexicon of the RDF properties that the fcrepo kernel (or close-to-core modules) use
 *
 * @author ajs6f
 */
public final class RdfLexicon {

    /**
     * Repository namespace &quot;fedora&quot;
    **/
    public static final String REPOSITORY_NAMESPACE = &quot;http://fedora.info/definitions/v4/repository#&quot;;

    public static final String FCREPO_API_NAMESPACE = &quot;http://fedora.info/definitions/fcrepo#&quot;;

    public static final String ACTIVITY_STREAMS_NAMESPACE = &quot;https://www.w3.org/ns/activitystreams#&quot;;

    public static final String EBUCORE_NAMESPACE = &quot;http://www.ebu.ch/metadata/ontologies/ebucore/ebucore#&quot;;

    public static final String OA_NAMESPACE = &quot;http://www.w3.org/ns/oa#&quot;;

    public static final String PROV_NAMESPACE = &quot;http://www.w3.org/ns/prov#&quot;;

    public static final String PREMIS_NAMESPACE = &quot;http://www.loc.gov/premis/rdf/v1#&quot;;

    public static final String MEMENTO_NAMESPACE = &quot;http://mementoweb.org/ns#&quot;;

    public static final String RDF_NAMESPACE = &quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;;

    /**
     * Namespace for the W3C WebAC vocabulary.
     */
    public static final String WEBAC_NAMESPACE_VALUE = &quot;http://www.w3.org/ns/auth/acl#&quot;;

    /**
     * Fedora configuration namespace &quot;fedora-config&quot;, used for user-settable
     * configuration properties.
     **/
    // TODO from UCDetector: Constant &quot;RdfLexicon.FEDORA_CONFIG_NAMESPACE&quot; has 0 references
    // should be referenced again when versioning is back in REST api
    public static final String FEDORA_CONFIG_NAMESPACE = // NO_UCD (unused code)
            &quot;info:fedoraconfig/&quot;;

    /**
     * Linked Data Platform namespace.
     */
    public static final String LDP_NAMESPACE = &quot;http://www.w3.org/ns/ldp#&quot;;

    /**
     * Is this namespace one that the repository manages?
     */
<span class="fc bfc" id="L83" title="All 2 branches covered.">    public static final Predicate&lt;String&gt; isManagedNamespace = p -&gt; p.equals(REPOSITORY_NAMESPACE) ||</span>
<span class="fc bfc" id="L84" title="All 4 branches covered.">            p.equals(LDP_NAMESPACE) || p.equals(MEMENTO_NAMESPACE);</span>

    // FIXITY

<span class="fc" id="L88">    public static final Resource FIXITY_TYPE = createResource(PREMIS_NAMESPACE + &quot;Fixity&quot;);</span>

<span class="fc" id="L90">    public static final Property HAS_MESSAGE_DIGEST_ALGORITHM =</span>
<span class="fc" id="L91">            createProperty(PREMIS_NAMESPACE + &quot;hasMessageDigestAlgorithm&quot;);</span>

<span class="fc" id="L93">    public static final Property HAS_MESSAGE_DIGEST =</span>
<span class="fc" id="L94">            createProperty(PREMIS_NAMESPACE + &quot;hasMessageDigest&quot;);</span>

<span class="fc" id="L96">    public static final Property HAS_SIZE =</span>
<span class="fc" id="L97">        createProperty(PREMIS_NAMESPACE + &quot;hasSize&quot;);</span>
<span class="fc" id="L98">    public static final Property HAS_FIXITY_RESULT =</span>
<span class="fc" id="L99">        createProperty(PREMIS_NAMESPACE + &quot;hasFixity&quot;);</span>

<span class="fc" id="L101">    private static final Set&lt;Property&gt; fixityProperties = of(</span>
            HAS_FIXITY_RESULT, HAS_MESSAGE_DIGEST);

<span class="fc" id="L104">    public static final Resource EVENT_OUTCOME_INFORMATION = createResource(PREMIS_NAMESPACE + &quot;EventOutcomeDetail&quot;);</span>

<span class="fc" id="L106">    public static final Property HAS_FIXITY_STATE =</span>
<span class="fc" id="L107">            createProperty(PREMIS_NAMESPACE + &quot;hasEventOutcome&quot;);</span>

<span class="fc" id="L109">    public static final Property WRITABLE =</span>
<span class="fc" id="L110">            createProperty(REPOSITORY_NAMESPACE + &quot;writable&quot;);</span>

    // Server managed properties
<span class="fc" id="L113">    public static final Property CREATED_DATE =</span>
<span class="fc" id="L114">            createProperty(REPOSITORY_NAMESPACE + &quot;created&quot;);</span>
<span class="fc" id="L115">    public static final Property CREATED_BY =</span>
<span class="fc" id="L116">            createProperty(REPOSITORY_NAMESPACE + &quot;createdBy&quot;);</span>
<span class="fc" id="L117">    public static final Property LAST_MODIFIED_DATE =</span>
<span class="fc" id="L118">            createProperty(REPOSITORY_NAMESPACE + &quot;lastModified&quot;);</span>
<span class="fc" id="L119">    public static final Property LAST_MODIFIED_BY =</span>
<span class="fc" id="L120">            createProperty(REPOSITORY_NAMESPACE + &quot;lastModifiedBy&quot;);</span>

<span class="fc" id="L122">    public static final Resource FEDORA_CONTAINER =</span>
<span class="fc" id="L123">            createResource(REPOSITORY_NAMESPACE + &quot;Container&quot;);</span>
<span class="fc" id="L124">    public static final Resource FEDORA_BINARY =</span>
<span class="fc" id="L125">            createResource(REPOSITORY_NAMESPACE + &quot;Binary&quot;);</span>
<span class="fc" id="L126">    public static final Resource FEDORA_RESOURCE =</span>
<span class="fc" id="L127">            createResource(REPOSITORY_NAMESPACE + &quot;Resource&quot;);</span>

    // Linked Data Platform
<span class="fc" id="L130">    public static final Property PAGE =</span>
<span class="fc" id="L131">        createProperty(LDP_NAMESPACE + &quot;Page&quot;);</span>
<span class="fc" id="L132">    public static final Resource CONTAINER =</span>
<span class="fc" id="L133">            createResource(LDP_NAMESPACE + &quot;Container&quot;);</span>
<span class="fc" id="L134">    public static final Resource BASIC_CONTAINER =</span>
<span class="fc" id="L135">            createResource(LDP_NAMESPACE + &quot;BasicContainer&quot;);</span>
<span class="fc" id="L136">    public static final Resource DIRECT_CONTAINER =</span>
<span class="fc" id="L137">            createResource(LDP_NAMESPACE + &quot;DirectContainer&quot;);</span>
<span class="fc" id="L138">    public static final Resource INDIRECT_CONTAINER =</span>
<span class="fc" id="L139">            createResource(LDP_NAMESPACE + &quot;IndirectContainer&quot;);</span>
<span class="fc" id="L140">    public static final Property MEMBERSHIP_RESOURCE =</span>
<span class="fc" id="L141">            createProperty(LDP_NAMESPACE + &quot;membershipResource&quot;);</span>
<span class="fc" id="L142">    public static final Property HAS_MEMBER_RELATION =</span>
<span class="fc" id="L143">            createProperty(LDP_NAMESPACE + &quot;hasMemberRelation&quot;);</span>
<span class="fc" id="L144">    public static final Property CONTAINS =</span>
<span class="fc" id="L145">        createProperty(LDP_NAMESPACE + &quot;contains&quot;);</span>
<span class="fc" id="L146">    public static final Property LDP_MEMBER =</span>
<span class="fc" id="L147">            createProperty(LDP_NAMESPACE + &quot;member&quot;);</span>
<span class="fc" id="L148">    public static final Resource RESOURCE =</span>
<span class="fc" id="L149">            createResource(LDP_NAMESPACE + &quot;Resource&quot;);</span>
<span class="fc" id="L150">    public static final Resource RDF_SOURCE =</span>
<span class="fc" id="L151">            createResource(LDP_NAMESPACE + &quot;RDFSource&quot;);</span>
<span class="fc" id="L152">    public static final Resource NON_RDF_SOURCE =</span>
<span class="fc" id="L153">        createResource(LDP_NAMESPACE + &quot;NonRDFSource&quot;);</span>
<span class="fc" id="L154">    public static final Property CONSTRAINED_BY =</span>
<span class="fc" id="L155">            createProperty(LDP_NAMESPACE + &quot;constrainedBy&quot;);</span>
<span class="fc" id="L156">    public static final Property MEMBER_SUBJECT =</span>
<span class="fc" id="L157">            createProperty(LDP_NAMESPACE + &quot;MemberSubject&quot;);</span>

<span class="fc" id="L159">    private static final Set&lt;Property&gt; ldpManagedProperties = of(CONTAINS);</span>

    // REPOSITORY INFORMATION
<span class="fc" id="L162">    public static final Property HAS_TRANSACTION_SERVICE =</span>
<span class="fc" id="L163">            createProperty(REPOSITORY_NAMESPACE + &quot;hasTransactionProvider&quot;);</span>

    // OTHER SERVICES
<span class="fc" id="L166">    public static final Property HAS_FIXITY_SERVICE =</span>
<span class="fc" id="L167">            createProperty(REPOSITORY_NAMESPACE + &quot;hasFixityService&quot;);</span>

    // BINARY DESCRIPTIONS
<span class="fc" id="L170">    public static final Property DESCRIBES =</span>
<span class="fc" id="L171">            createProperty(&quot;http://www.iana.org/assignments/relation/describes&quot;);</span>
<span class="fc" id="L172">    public static final Property DESCRIBED_BY =</span>
<span class="fc" id="L173">            createProperty(&quot;http://www.iana.org/assignments/relation/describedby&quot;);</span>

<span class="fc" id="L175">    public static final Resource INACCESSIBLE_RESOURCE =</span>
<span class="fc" id="L176">            createResource(REPOSITORY_NAMESPACE + &quot;inaccessibleResource&quot;);</span>
<span class="fc" id="L177">    public static final Property HAS_MIME_TYPE =</span>
<span class="fc" id="L178">            createProperty(EBUCORE_NAMESPACE + &quot;hasMimeType&quot;);</span>
<span class="fc" id="L179">    public static final Property HAS_ORIGINAL_NAME =</span>
<span class="fc" id="L180">            createProperty(EBUCORE_NAMESPACE + &quot;filename&quot;);</span>

    // EXTERNAL CONTENT
<span class="fc" id="L183">    public static final Property EXTERNAL_CONTENT = createProperty(FCREPO_API_NAMESPACE + &quot;ExternalContent&quot;);</span>
<span class="fc" id="L184">    public static final Property PROXY_FOR = createProperty(REPOSITORY_NAMESPACE + &quot;proxyFor&quot;);</span>
<span class="fc" id="L185">    public static final Property REDIRECTS_TO = createProperty(REPOSITORY_NAMESPACE + &quot;redirectsTo&quot;);</span>

    // RDF EXTRACTION
<span class="fc" id="L188">    public static final Property INBOUND_REFERENCES = createProperty(FCREPO_API_NAMESPACE + &quot;PreferInboundReferences&quot;);</span>
<span class="fc" id="L189">    public static final Property PREFER_SERVER_MANAGED = createProperty(REPOSITORY_NAMESPACE + &quot;ServerManaged&quot;);</span>

<span class="fc" id="L191">    public static final Property EMBED_CONTAINED = createProperty(OA_NAMESPACE + &quot;PreferContainedDescriptions&quot;);</span>


    // WEBAC
    public static final String WEBAC_ACCESS_CONTROL_VALUE = WEBAC_NAMESPACE_VALUE + &quot;accessControl&quot;;

    public static final String SERVER_MANAGED_PROPERTIES_MODE = &quot;fcrepo.properties.management&quot;;

    // Properties which are managed by the server but are not from managed namespaces
    private static final Set&lt;Property&gt; serverManagedProperties;
    static {
<span class="fc" id="L202">        final ImmutableSet.Builder&lt;Property&gt; b = ImmutableSet.builder();</span>
<span class="fc" id="L203">        b.addAll(fixityProperties).addAll(ldpManagedProperties);</span>
<span class="fc" id="L204">        serverManagedProperties = b.build();</span>
    }

<span class="fc" id="L207">    private static final Predicate&lt;Property&gt; hasFedoraNamespace =</span>
<span class="fc bfc" id="L208" title="All 4 branches covered.">        p -&gt; !p.isAnon() &amp;&amp; p.getNameSpace().startsWith(REPOSITORY_NAMESPACE);</span>

<span class="fc" id="L210">    private static Predicate&lt;Property&gt; hasMementoNamespace =</span>
<span class="fc bfc" id="L211" title="All 4 branches covered.">        p -&gt; !p.isAnon() &amp;&amp; p.getNameSpace().startsWith(MEMENTO_NAMESPACE);</span>

    // Server managed properties which may be overridden by clients when the server is in &quot;relaxed&quot; mode
<span class="fc" id="L214">    private static final Set&lt;Property&gt; relaxableProperties = of(LAST_MODIFIED_BY, LAST_MODIFIED_DATE, CREATED_BY,</span>
            CREATED_DATE);

    // Detects if a server managed property is allowed to be updated in &quot;relaxed&quot; mode
<span class="fc" id="L218">    public static final Predicate&lt;Property&gt; isRelaxed =</span>
<span class="fc bfc" id="L219" title="All 2 branches covered.">            p -&gt; relaxableProperties.contains(p)</span>
<span class="fc bfc" id="L220" title="All 2 branches covered.">                    &amp;&amp; (&quot;relaxed&quot;.equals(System.getProperty(SERVER_MANAGED_PROPERTIES_MODE)));</span>

    /**
     * Detects whether an RDF property is managed by the repository.
     */
<span class="fc" id="L225">    public static final Predicate&lt;Property&gt; isManagedPredicate =</span>
<span class="fc" id="L226">            hasFedoraNamespace.or(hasMementoNamespace).or(p -&gt; serverManagedProperties.contains(p));</span>

    /**
     * Fedora defined JCR node type with supertype of nt:file with two nt:folder named fedora:timemap and
     * fedora:binaryTimemap inside.
     */
    public static final String NT_VERSION_FILE = &quot;nt:versionFile&quot;;

    /**
     * Fedora defined JCR node type which can have no children except optionally a timemap
     */
    public static final String NT_LEAF_NODE = &quot;nt:leafNode&quot;;

    /**
     * Fedora defined node path for a binary description.
     */
    public static final String FEDORA_DESCRIPTION = &quot;fedora:description&quot;;

    // VERSIONING
    /**
     * Memento TimeMap type.
     */
    public static final String VERSIONING_TIMEMAP_TYPE = MEMENTO_NAMESPACE + &quot;TimeMap&quot;;

    /**
     * Memento TimeGate type.
     */
    public static final String VERSIONING_TIMEGATE_TYPE = MEMENTO_NAMESPACE + &quot;TimeGate&quot;;

    /**
     * Type for memento objects.
     */
    public static final String MEMENTO_TYPE = MEMENTO_NAMESPACE + &quot;Memento&quot;;

    /**
     * This is an internal RDF type for versionable resources, this may be replaced by a Memento type.
     */
<span class="fc" id="L263">    public static final Resource VERSIONED_RESOURCE =</span>
<span class="fc" id="L264">        createResource(MEMENTO_NAMESPACE + &quot;OriginalResource&quot;);</span>

    /*
     * Interaction Models.
     */
<span class="fc" id="L269">    public static final Set&lt;Resource&gt; INTERACTION_MODEL_RESOURCES = of(</span>
            BASIC_CONTAINER, INDIRECT_CONTAINER, DIRECT_CONTAINER, NON_RDF_SOURCE);

<span class="fc" id="L272">    public static final Set&lt;String&gt; INTERACTION_MODELS = INTERACTION_MODEL_RESOURCES.stream()</span>
<span class="fc" id="L273">            .map(m -&gt; m.getURI().replace(LDP_NAMESPACE, &quot;ldp:&quot;))</span>
<span class="fc" id="L274">            .collect(Collectors.toSet());</span>

    private RdfLexicon() {

    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>